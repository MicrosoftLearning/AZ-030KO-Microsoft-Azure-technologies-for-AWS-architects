# 미니 랩: VNet 피어링

> **참고**: 이 미니 랩에서는 두 개의 가상 네트워크가 필요합니다.

## 가상 네트워크 만들기
1. [https://portal.azure.com](https://portal.azure.com/) 에서 Azure 포털에 로그인

1. 페이지 상단의 검색상자에서 "가상 네트워크"를 검색하고 해당 이름의 리소스를 클릭합니다. 새 뷰가 나타납니다.

1. 이 새 뷰에서 `+ 추가` 단추를 클릭합니다.

1. 가상 네트워크를 저장할 구독 및 리소스 그룹을 선택합니다.
    * 리소스 그룹이 없는 경우 "새로 만들기"를 클릭하고 원하는 이름을 지정하세요.

1. 가상 네트워크에 이름(예: "`virtualnetwork1`")을 지정하고 원하는 지역을 선택합니다.

1. `검토 + 만들기` 를 클릭합니다.

1. 잠시 기다립니다.

1. `만들기` 클릭

1. 2개의 가상 네트워크를 사용할 수 있도록 `virtualnetwork2` 에 대해 이 프로세스를 반복합니다.


## 첫 번째 가상 네트워크에서 VNet 피어링 구성

1. 첫 번째 가상 네트워크를 선택합니다. 

1. 가상 네트워크의 이름 바로 아래의 검색 표시줄에서 "**피어링**"을 검색하고 "**피어링**" 옵션을 선택합니다.

1. **+ 추가**를 선택합니다. 새 뷰로 이동합니다.

    + 첫 번째 가상 네트워크 피어링의 **이름**을 제공합니다. VNet1toVNet2 등을 예로 들 수 있습니다. 

    + **가상 네트워크** 드롭 다운에서 피어링하려는 두 번째 가상 네트워크를 선택합니다. 

    + VPN 게이트웨이를 구성할 때 지역이 필요합니다. 

    + 두 번째 가상 네트워크 피어링의 이름을 입력합니다. VNet2toVNet1 을 예로 들 수 있습니다. 

    + 정보 아이콘을 사용하여 네트워크 액세스, 전달된 트래픽 및 게이트웨이 전송 설정을 검토합니다.

    + **게이트웨이 전송 허용** 확인란을 선택합니다. 가상 네트워크에 게이트웨이가 없다는 오류를 기록합니다. 

    + **게이트웨이 전송 허용** 확인란이 선택되어 있지 않은지 확인합니다.

    + **확인**을 클릭하여 설정을 저장합니다.

## VPN 게이트웨이 구성

1. **Azure Portal**에서 **가상 네트워크 게이트웨이**를 검색합니다.

1. **+ 추가**를 선택합니다.

    + 가상 네트워크 게이트웨이의 **이름**을 입력합니다. VNet1Gateway를 예로 들 수 있습니다.

    + 게이트웨이가 첫 번째 가상 네트워크와 동일한 지역에 있는지 확인합니다.

    + **가상 네트워크** 드롭 다운에서 첫 번째 가상 네트워크를 선택합니다.

    + **공용 IP 주소** 영역에서 **새로 만들기**를 클릭하고 IP 주소 이름을 지정합니다.

    + **만들기 및 검토**를 클릭합니다. 유효성 검사 오류를 해결합니다.

    + **만들기**를 클릭합니다. 

1. 게이트웨이가 성공적으로 만들어질 때까지 잠시 기다립니다(알림이 표시됨).

### 게이트웨이 전송 허용

1. **Azure Portal**에서 첫 번째 가상 네트워크로 돌아갑니다. 

1. **개요** 블레이드에서 VPN 게이트웨이에 대하여 새로 **연결된 장치**를 확인합니다.

1. 게이트웨이를 선택하여 상태 확인을 수행하고 액세스 통계를 검토할 수 있습니다. 

1. 이전 페이지로 돌아가서(오른쪽 상단의 `X` 를 클릭) 가상 네트워크 이름 바로 아래의 검색 표시줄에서 다시 "**피어링**"을 입력하고 표시되는 옵션을 클릭합니다.

    + 피어링 선택 
    
    + **게이트웨이 전송 허용** 설정. 이전 오류가 해결되었습니다. 

    + 선택이 완료된 후, **원격 게이트웨이 사용**이 비활성화됩니다. 

1. ("게이트웨이 전송 허용" 확인란을 선택하여) 변경 사항을 **저장**합니다.

## 두 번째 가상 네트워크에서 VNet 피어링 확인

1. **Azure Portal**에서 두 번째 가상 네트워크를 선택합니다. 

1. 가상 네트워크의 이름 바로 아래에 있는 검색 표시줄에 "**피어링**"을 입력하고 표시되는 옵션을 클릭합니다.

1. 피어링이 자동으로 만들어졌습니다. 이름은 첫 번째 가상 네트워크 피어링을 구성할 때 제공한 이름입니다. 

1. **피어링 상태**가 **연결**로 설정되어 있음을 확인합니다.

1. 피어링을 클릭합니다.

    + **원격 게이트웨이 사용**은 선택할 수 없습니다.

    + 정보 아이콘을 사용하여 **원격 게이트웨이 사용** 설정을 검토합니다.

1. 변경 내용을 **취소**합니다. 

 
